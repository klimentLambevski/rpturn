/*!
 * 
 *   @kliment/rpturn v0.1.0
 *   https://github.com/klimentLambevski/rpturn
 * 
 *   Copyright (c) Kliment Lambevski (https://github.com/klimentLambevski)
 * 
 *   This source code is licensed under the MIT license found in the
 *   LICENSE file in the root directory of this source tree.
 *   
 */
!function(e,r){"object"===typeof exports&&"object"===typeof module?module.exports=r(require("@kliment/peerjs")):"function"===typeof define&&define.amd?define("MyLibrary",["@kliment/peerjs"],r):"object"===typeof exports?exports.MyLibrary=r(require("@kliment/peerjs")):e.MyLibrary=r(e["@kliment/peerjs"])}(window,(function(e){return function(e){var r={};function __webpack_require__(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,__webpack_require__),n.l=!0,n.exports}return __webpack_require__.m=e,__webpack_require__.c=r,__webpack_require__.d=function(e,r,t){__webpack_require__.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},__webpack_require__.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.t=function(e,r){if(1&r&&(e=__webpack_require__(e)),8&r)return e;if(4&r&&"object"===typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(__webpack_require__.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)__webpack_require__.d(t,n,function(r){return e[r]}.bind(null,n));return t},__webpack_require__.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpack_require__.d(r,"a",r),r},__webpack_require__.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=1)}([function(r,t){r.exports=e},function(e,r,t){e.exports=t(2)},function(e,r,t){"use strict";t.r(r);var n=t(0),o=t.n(n),i={apiUrl:"https://api-tool.rpturn.com",healthCheckEndpoint:"/api/health-check",fallbackTurnServer:"turn.vitech.dev",signalServer:"api.rpturn.com"};function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var u={host:"localhost",port:4e3};u={host:i.signalServer,secure:!0};var peer_createPeer=function(e,r,t,n,i){var c=r.ip,a=[{urls:["turn:".concat(c)],username:n.key,credential:n.token},{urls:["stun:".concat(c)],username:n.key,credential:n.token}];return console.log(a),new o.a(e,function(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({},u,{path:"/signal",config:{iceServers:a,iceTransportPolicy:t?"relay":"all"}},n,{debug:i}))};function api_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function api_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?api_ownKeys(Object(t),!0).forEach((function(r){api_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):api_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function api_defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function timeout(e,r){return new Promise((function(t,n){setTimeout((function(){n(new Error("timeout"))}),e),r.then(t,n)}))}function _toConsumableArray(e){return function(e){if(Array.isArray(e)){for(var r=0,t=new Array(e.length);r<e.length;r++)t[r]=e[r];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var rpturn_getServerList=function(e){return(r=i.apiUrl,t={key:e.key,token:e.token},fetch(r,{method:"POST",body:JSON.stringify({query:"\n        query {ips:listInstancesIp}\n      ",variables:{}}),headers:api_objectSpread({},t,{"Content-Type":"application/json"})}).then((function(e){return e.json()}))).then((function(e){return e.data.ips}));var r,t},rpturn_checkServersLatency=function(e){return Promise.all(e.map((function(e){var r=window.performance.now();return function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return timeout(2e3,fetch(e,{method:"GET",headers:r}))}("https://".concat(e).concat(i.healthCheckEndpoint)).then((function(){return{delay:window.performance.now()-r,ip:e}})).catch((function(){return{delay:2e3,ip:e}}))}))).then((function(e){var r=Math.min.apply(Math,_toConsumableArray(e.map((function(e){return e.delay}))));return e.find((function(e){return e.delay===r}))}))};var c={init:function(e){var r=e.credentials,t=e.id,n=e.turnOnly,o=void 0!==n&&n,u=e.debug,c=void 0===u?0:u,a=function(e){var r=e[0];return{key:r.username,token:r.credential}}(r);return rpturn_getServerList(a).then((function(e){return rpturn_checkServersLatency(e)})).then((function(e){return e=e&&e.delay<4e3?e:[{ip:i.fallbackTurnServer}],peer_createPeer(t,e,o,a,c)}))}};r.default=c}])}));
//# sourceMappingURL=index.js.map